<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <link href="http://cdncatalog.com/assets/flat-ui/css/bootstrap.css" rel="stylesheet">
        <link href="http://cdncatalog.com/assets/flat-ui/css/flat-ui.css" rel="stylesheet">

        <style>
            .field-error { color: red; }
        </style>
    </head>
    <body class="row">

        <div id="form-holder" class="span4"></div>
        <div id="records-list" class="span8"></div>

        <script type="text/javascript">
            window.onload = function () {

                Daybed.SETTINGS.SERVER = "http://daybed.lolnet.org";

                //
                // Instantiate Models and Views
                //
                // Load definition by its id.
                // Uses location #hash, with default for demo
                var id = window.location.hash.slice(1) || 'demo-quotes';
                    definition = new Daybed.Definition({id: id}),
                    itemList = new Daybed.ItemList(definition);

                // Instantiate views
                var listView = new Daybed.TableView({collection: itemList})
                    formView = new Daybed.FormView({definition: definition});

                // Wait for definition to be fetched from server
                // in order to populate form fields and list headers
                definition.whenReady(function () {
                    $('#records-list').html(listView.render().el);
                    $('#form-holder').html(formView.render().el);
                });

                // Fetch definition !
                definition.fetch();
                // Fetch records !
                itemList.fetch();

                //
                // Cable list and form events
                //
                // Rebuild the form with bound instance on edit.
                listView.on('edit', function (record, row) {
                    $('tr.info').removeClass('info');
                    row.$el.addClass('info');
                    formView.setup(record);
                    formView.render();
                });

                // On creation, add to the collection.
                formView.on('created', function (record) {
                    itemList.add(record);
                });

                // After cancel or edition, empty the form.
                formView.on('cancel saved created', function () {
                    formView.setup(null);
                    formView.render();
                    $('tr.info').removeClass('info');
                });

            };
        </script>

        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.0/mustache.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/backbone-forms/0.12.0/backbone-forms.min.js"></script>
        <script type="text/javascript" src="backbone-daybed.js"></script>
    </body>
</html>
